<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Realtime Database Example</title>
</head>
<body>
  <h1>Firebase Realtime Database Test</h1>

  <label for="name">名前:</label>
  <input type="text" id="name" placeholder="例: Taro">
  <label for="age">年齢:</label>
  <input type="number" id="age" placeholder="例: 25">
  <button id="saveBtn">データを保存</button>

  <h2>保存されたデータ</h2>
  <pre id="output"></pre>

  <script type="module">
    // Firebase App 初期化
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    // Firebase 設定
    const firebaseConfig = {
        apiKey: "AIzaSyAHb1pT_SgqolYZdpOsmQdLK-OMjNVpVYA",   // あなたのAPIキー
        authDomain: "hudarogu-71a4f.firebaseapp.com",       // 認証ドメイン
        databaseURL: "https://hudarogu-71a4f-default-rtdb.firebaseio.com", // Realtime Database URL
        projectId: "hudarogu-71a4f",                        // プロジェクトID
        storageBucket: "hudarogu-71a4f.appspot.com",        // ストレージバケット
        messagingSenderId: "453627568918",                  // メッセージ送信ID
        appId: "1:453627568918:web:85f634cfa2d0ca358e2637", // アプリID
        measurementId: "G-EVDBZ70E5C"                      // Analytics測定ID
        };


    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);

    // HTML要素の取得
    const nameInput = document.getElementById("name");
    const ageInput = document.getElementById("age");
    const saveBtn = document.getElementById("saveBtn");
    const output = document.getElementById("output");

    // データ保存ボタン
    saveBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      const age = parseInt(ageInput.value);

      if (!name || isNaN(age)) {
        alert("名前と年齢を正しく入力してください");
        return;
      }

      // データベースに書き込み
      set(ref(database, 'users/' + name), {
        name: name,
        age: age
      })
      .then(() => {
        alert("データを保存しました");
        nameInput.value = "";
        ageInput.value = "";
      })
      .catch((error) => {
        console.error("保存エラー:", error);
      });
    });

    // データベースの内容をリアルタイムで取得
    const usersRef = ref(database, 'users');
    onValue(usersRef, (snapshot) => {
      const data = snapshot.val();
      output.textContent = JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>